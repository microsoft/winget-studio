<?xml version="1.0" encoding="utf-8"?>
<ContentDialog
    x:Class="WinGetStudio.Views.ResourceExplorer"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:WinGetStudio.Services.DesiredStateConfiguration.Explorer.Models"
    xmlns:localControls="using:WinGetStudio.Views.Controls"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    Style="{StaticResource DefaultContentDialogStyle}"
    mc:Ignorable="d">

    <ContentDialog.Resources>
        <!-- Configure the dialog size and layout -->
        <x:Double x:Key="ContentDialogMinWidth">800</x:Double>
        <x:Double x:Key="ContentDialogMaxWidth">800</x:Double>
        <Thickness x:Key="ContentDialogPadding">0</Thickness>

        <!-- Configure the table column widths -->
        <GridLength x:Key="NameColumnWidth">200</GridLength>
        <GridLength x:Key="TypeColumnWidth">150</GridLength>
    </ContentDialog.Resources>

    <Grid>
        <!-- Close button -->
        <Button Style="{ThemeResource AlternateCloseButtonStyle}" Click="OnClose" />

        <!-- Main content -->
        <Grid RowSpacing="8" Padding="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Presentation mode selector -->
            <controls:Segmented SelectedIndex="0" x:Name="SegmentedModeView" HorizontalAlignment="Center">
                <controls:SegmentedItem x:Name="SummaryView"
                                        x:Uid="ResourceExplorer_SummaryView"
                                        AutomationProperties.PositionInSet="1"
                                        AutomationProperties.SizeOfSet="2" />
                <controls:SegmentedItem x:Name="CodeView"
                                        x:Uid="ResourceExplorer_CodeView"
                                        AutomationProperties.PositionInSet="2"
                                        AutomationProperties.SizeOfSet="2" />
            </controls:Segmented>
            
            <!-- Summary view -->
            <ListView Grid.Row="1"
                      ItemsSource="{x:Bind ViewModel.Properties, Mode=OneWay}"
                      SelectionMode="None"
                      Visibility="{x:Bind SummaryView.IsSelected, Mode=OneWay}"> 
                <ListView.Header>
                    <Grid Padding="{ThemeResource SectionPadding}" ColumnSpacing="{ThemeResource SectionSpacing}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="{StaticResource NameColumnWidth}" />
                            <ColumnDefinition Width="{StaticResource TypeColumnWidth}" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- Name | Type | Syntax-->
                        <TextBlock x:Uid="ResourceExplorer_Name"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        <TextBlock x:Uid="ResourceExplorer_Type"
                                   Grid.Column="1"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        <TextBlock x:Uid="ResourceExplorer_Syntax"
                                   Grid.Column="2"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </Grid>
                </ListView.Header>
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:DSCProperty">
                        <Grid ColumnSpacing="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="{StaticResource NameColumnWidth}" />
                                <ColumnDefinition Width="{StaticResource TypeColumnWidth}" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <!-- Propety name -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="auto" />
                                </Grid.ColumnDefinitions>
                                <!-- Name -->
                                <TextBlock Text="{x:Bind Name}"
                                           VerticalAlignment="Center"
                                           IsTextSelectionEnabled="True"
                                           Style="{ThemeResource BodyStrongTextBlockStyle}"
                                           TextTrimming="CharacterEllipsis" />

                                <!-- Copy button -->
                                <localControls:CopyButton Grid.Column="1"
                                                          Background="Transparent"
                                                          BorderThickness="0"
                                                          Tag="{x:Bind Name}"
                                                          Click="OnCopyPropertyName"
                                                          Content="&#xE8C8;"/>
                            </Grid>

                            <!-- Property type -->
                            <TextBlock Grid.Column="1"
                                       Text="{x:Bind Type}"
                                       IsTextSelectionEnabled="True"
                                       VerticalAlignment="Center"
                                       TextTrimming="CharacterEllipsis" />

                            <!-- Property syntax -->
                            <ScrollViewer Grid.Column="2"
                                          HorizontalScrollBarVisibility="Auto"
                                          HorizontalScrollMode="Auto">
                                <TextBlock IsTextSelectionEnabled="True"
                                           VerticalAlignment="Center"
                                           FontFamily="{StaticResource CascadiaMonoFontFamily}"
                                           Text="{x:Bind GetOneLinerSyntax()}"/>
                            </ScrollViewer>
                                
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <!-- Code view -->
            <ScrollViewer Grid.Row="1"
                          Visibility="{x:Bind CodeView.IsSelected, Mode=OneWay}"
                          HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Auto">
                <TextBlock FontSize="{ThemeResource CaptionTextBlockFontSize}"
                           Padding="15"
                           IsTextSelectionEnabled="True"
                           FontFamily="{StaticResource CascadiaMonoFontFamily}"
                           Text="{x:Bind ViewModel.ResourceSyntax, Mode=OneWay}" />
            </ScrollViewer>
        </Grid>
    </Grid>
</ContentDialog>
