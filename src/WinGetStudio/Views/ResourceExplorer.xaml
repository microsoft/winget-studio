<?xml version="1.0" encoding="utf-8"?>
<ContentDialog
    x:Class="WinGetStudio.Views.ResourceExplorer"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:WinGetStudio.Services.DesiredStateConfiguration.Explorer.Models"
    xmlns:localControls="using:WinGetStudio.Views.Controls"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    Style="{StaticResource DefaultContentDialogStyle}"
    mc:Ignorable="d">

    <ContentDialog.Resources>
        <!-- Configure the dialog size and layout -->
        <x:Double x:Key="ContentDialogMinWidth">800</x:Double>
        <x:Double x:Key="ContentDialogMaxWidth">800</x:Double>
        <Thickness x:Key="ContentDialogPadding">0</Thickness>

        <!-- Configure the table column widths -->
        <GridLength x:Key="NameColumnWidth">200</GridLength>
        <GridLength x:Key="TypeColumnWidth">150</GridLength>
    </ContentDialog.Resources>

    <Grid x:Name="PageRoot" Tag="{x:Bind}">
        <!-- Close button -->
        <Button Style="{ThemeResource AlternateCloseButtonStyle}" Click="OnClose" />

        <!-- Main content -->
        <Grid RowSpacing="8" Padding="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Presentation mode selector -->
            <CommandBar HorizontalAlignment="Left" DefaultLabelPosition="Right">
                <AppBarButton x:Uid="ResourceExplorer_View" Icon="View">
                    <AppBarButton.Flyout>
                        <MenuFlyout>
                            <RadioMenuFlyoutItem x:Name="SummaryView" x:Uid="ResourceExplorer_SummaryView" IsChecked="{x:Bind ViewModel.IsSummaryView, Mode=OneWay}">
                                <RadioMenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xF232;" FontFamily="{ThemeResource SymbolThemeFontFamily}" />
                                </RadioMenuFlyoutItem.Icon>
                            </RadioMenuFlyoutItem>
                            <RadioMenuFlyoutItem x:Name="CodeView" x:Uid="ResourceExplorer_CodeView" IsChecked="{x:Bind ViewModel.IsCodeView, Mode=TwoWay}">
                                <RadioMenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE943;" />
                                </RadioMenuFlyoutItem.Icon>
                            </RadioMenuFlyoutItem>
                        </MenuFlyout>
                    </AppBarButton.Flyout>
                </AppBarButton>
                <AppBarButton x:Uid="ResourceExplorer_CopyAsYaml" Icon="Copy" Click="OnCopyAsYaml" />
            </CommandBar>

            <!-- Summary view -->
            <ListView Grid.Row="1"
                      ItemsSource="{x:Bind ViewModel.Properties}"
                      SelectionMode="None"
                      Visibility="{x:Bind SummaryView.IsChecked, Mode=OneWay}">
                <ListView.Header>
                    <Grid Padding="{ThemeResource SectionPadding}" ColumnSpacing="{ThemeResource SectionSpacing}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="{StaticResource NameColumnWidth}" />
                            <ColumnDefinition Width="{StaticResource TypeColumnWidth}" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- Name | Type | Code -->
                        <TextBlock x:Uid="ResourceExplorer_Name"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        <TextBlock x:Uid="ResourceExplorer_Type"
                                   Grid.Column="1"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        <TextBlock x:Uid="ResourceExplorer_Code"
                                   Grid.Column="2"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </Grid>
                </ListView.Header>
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:DSCProperty">
                        <Grid ColumnSpacing="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="{StaticResource NameColumnWidth}" />
                                <ColumnDefinition Width="{StaticResource TypeColumnWidth}" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <!-- Propety name -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="auto" />
                                </Grid.ColumnDefinitions>
                                <!-- Name -->
                                <TextBlock Text="{x:Bind Name}"
                                           VerticalAlignment="Center"
                                           IsTextSelectionEnabled="True"
                                           Style="{ThemeResource BodyStrongTextBlockStyle}"
                                           TextTrimming="CharacterEllipsis" />

                                <!-- Copy button -->
                                <localControls:CopyButton Grid.Column="1"
                                                          Background="Transparent"
                                                          BorderThickness="0"
                                                          Tag="{x:Bind Name}"
                                                          Click="OnCopyPropertyName"
                                                          Content="&#xE8C8;"/>
                            </Grid>

                            <!-- Property type -->
                            <TextBlock Grid.Column="1"
                                       Text="{x:Bind Type}"
                                       IsTextSelectionEnabled="True"
                                       VerticalAlignment="Center"
                                       TextTrimming="CharacterEllipsis" />

                            <!-- Property code -->
                            <ScrollViewer Grid.Column="2"
                                          HorizontalScrollBarVisibility="Auto"
                                          HorizontalScrollMode="Auto">
                                <controls:SwitchPresenter Value="{Binding ElementName=PageRoot, Path=Tag.ViewModel.CanShowJsonSchema}" TargetType="x:Boolean">
                                    <controls:Case Value="True">
                                        <HyperlinkButton x:Uid="ResourceExplorer_ViewJsonSchema" Command="{Binding ElementName=PageRoot, Path=Tag.ViewModel.ShowJsonSchemaCommand}" />
                                    </controls:Case>
                                    <controls:Case Value="False">
                                        <TextBlock IsTextSelectionEnabled="True"
                                                   VerticalAlignment="Center"
                                                   FontFamily="{StaticResource CascadiaMonoFontFamily}"
                                                   Text="{x:Bind GetOneLinerCode()}"/>
                                    </controls:Case>
                                </controls:SwitchPresenter>
                            </ScrollViewer>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <!-- Code view -->
            <localControls:MonacoEditor Grid.Row="1"
                                        Height="500"
                                        Visibility="{x:Bind CodeView.IsChecked, Mode=OneWay}"
                                        Text="{x:Bind ViewModel.ResourceCode}"
                                        IsReadOnly="True"
                                        Syntax="{x:Bind ViewModel.ResourceSyntax}"/>
        </Grid>
    </Grid>
</ContentDialog>
